[build]
builder = "NIXPACKS"
buildCommand = "npm run railway:build"
watchPatterns = ["**/*.ts", "**/*.tsx", "**/*.js", "**/*.jsx", "**/*.json"]

# Ensure environment variables are available during build
[build.env]
VITE_SUPABASE_URL = "$VITE_SUPABASE_URL"
VITE_SUPABASE_ANON_KEY = "$VITE_SUPABASE_ANON_KEY"
NODE_ENV = "production"

[deploy]
startCommand = "npm run railway:start"
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10
healthcheckPath = "/api/health"
healthcheckTimeout = 300

[environments.production]
variables = { NODE_ENV = "production" }

[environments.development]
variables = { NODE_ENV = "development" }

# Health check configuration
[healthcheck]
path = "/api/health"
interval = 30
timeout = 10

# Port configuration
[variables]
PORT = "3000"